# Управление Онтологией Проекта SCB DB

Эта директория содержит определения Онтологии данных для проекта SCB DB.
Онтология определяет структуру, типы, семантику и взаимосвязи данных, хранящихся в системе.

**Критически важно:** Данная директория в Git-репозитории является **единственным источником правды (Single Source of Truth)** для всех версий Онтологии.

## Структура Директории

*   `versions/`: Содержит подпапки для каждой выпущенной версии Онтологии (например, `v1.0/`, `v1.1/`).
    *   Каждая папка версии (например, `v1.0/`) содержит:
        *   `schema.yaml`: Основной файл, описывающий атрибуты, их типы, роли и т.д.
        *   `vocabularies/` (опционально): Подпапка с файлами-справочниками (например, `countries.yaml`).
        *   `hierarchies.yaml` (опционально): Описание иерархических связей.
        *   `validation_rules.yaml` (опционально): Дополнительные правила валидации.
*   `mapping/` (опционально, для будущих версий): Содержит файлы, описывающие правила преобразования (маппинга) данных между различными версиями Онтологии.
*   `README.md` (этот файл): Описание данной директории и процесса управления Онтологией.

## Процесс Внесения Изменений в Онтологию

Любые изменения в Онтологию (добавление/изменение/удаление атрибутов, справочников, иерархий, правил валидации) должны проходить следующие этапы:

1.  **Создание Ветки:** От основной ветки разработки (например, `develop` или `main`) создается новая feature-ветка или bugfix-ветка согласно принятым правилам именования (например, `feature/ONT-XXX-add-new-attribute`).
2.  **Редактирование YAML-файлов:** В созданной ветке вносятся необходимые изменения в соответствующие YAML-файлы внутри папки `ontology/versions/<новая_или_текущая_версия>/`.
    *   **Новая версия:** Если изменения значительны и несовместимы с предыдущей версией, создается новая папка версии (например, `v1.1/`). Номер версии должен следовать семантическому версионированию (МАЖОР.МИНОР.ПАТЧ), хотя для MVP это может быть упрощено.
    *   **Существующая версия:** Если изменения обратно совместимы (например, добавление нового опционального атрибута), они могут вноситься в файлы текущей версии.
    *   **Важно:** Соблюдать синтаксис YAML и структуру, определенную для каждого типа файла Онтологии.
3.  **Коммит(ы):** Изменения коммитятся с использованием стандарта Conventional Commits, с указанием номера связанной задачи (если есть). Пример: `feat(ontology): add 'currency' attribute to v1.1 schema`.
4.  **Создание Pull Request (PR) / Merge Request (MR):** Создается PR/MR из feature/bugfix-ветки в основную ветку разработки. В описании PR/MR необходимо детально описать внесенные изменения, их причину и влияние на систему, особенно на ETL-процессы и существующие данные.
5.  **Ревью:** PR/MR должен пройти обязательное ревью как минимум одним другим членом команды (например, Мейнтейнером Онтологии или ведущим разработчиком). Ревьюер проверяет корректность изменений, их соответствие требованиям и общим принципам дизайна Онтологии.
6.  **Мерж:** После успешного ревью и одобрения, PR/MR мержатся в основную ветку разработки.

## Синхронизация с Оперативной Копией в MongoDB

После того как изменения смержены в основную ветку Git-репозитория `ontology/`, **автоматический процесс, управляемый Airflow DAG `ontology_sync_dag.py`**, отслеживает эти изменения. Этот DAG:
1.  Извлекает последнюю версию Онтологии из Git.
2.  (Опционально) Валидирует ее.
3.  Загружает новую версию в оперативную копию Онтологии в MongoDB как "Green" (неактивную) версию.
4.  (Опционально) Выполняет тесты на "Green" версии.
5.  Атомарно переключает указатель активной версии в MongoDB на новую "Green" версию, делая ее "Blue" (активной).

**Критически важно: Прямое изменение оперативной копии Онтологии в MongoDB (минуя процесс Git -> Airflow DAG) строжайше ЗАПРЕЩЕНО.**